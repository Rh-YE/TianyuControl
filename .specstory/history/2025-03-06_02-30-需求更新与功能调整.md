<!-- Generated by SpecStory -->

# 需求更新与功能调整 (2025-03-06 10:30:26)

_**User**_

再进行一下需求更新：
增加GPS时间
增加圆顶状态 角度 天窗开关
去掉相机状态 和滤镜论
主镜罩
高度方位驱动器状态 写驱动器使能 和电源状态
去掉相机温度

---

_**Assistant**_

# 需求更新方案

我将根据您的需求对望远镜监控系统界面进行更新。主要变更包括：增加GPS时间显示、圆顶状态信息、主镜罩状态，添加高度方位驱动器状态，同时移除相机状态与滤镜信息及相机温度。

## 主要修改

```python:src/ui/main_window.py
// ... existing code ...
from PyQt5.QtWidgets import QWidget, QVBoxLayout, QHBoxLayout, QLabel
from PyQt5.QtCore import Qt, QTimer
from PyQt5.QtGui import QImage, QPixmap
from src.ui.components import LabelPair, DeviceControl, InfoGroup, ThemeButton, AngleVisualizer
from src.utils.i18n import i18n
from src.utils.theme_manager import theme_manager
from src.services.astronomy_service import astronomy_service
from src.services.device_service import device_service
from src.config.settings import TELESCOPE_CONFIG, DEVICES, LAYOUT_CONFIG
import os
import time

class MainWindow(QWidget):
    def __init__(self):
        super().__init__()
        self.init_ui()
        self.init_timer()

    def init_ui(self):
        """初始化UI"""
        // ... existing code ...

        # 左侧栏
        left_layout = QVBoxLayout()
        left_layout.setSpacing(LAYOUT_CONFIG['group_spacing'])
        
        # 基本信息组
        self.basic_info = InfoGroup('basic_info')
        self.basic_info.layout.setSpacing(LAYOUT_CONFIG['widget_spacing'])
        self.basic_info.add_item('aperture', TELESCOPE_CONFIG['aperture'])
        self.basic_info.add_item('fov', TELESCOPE_CONFIG['field_of_view'])
        self.basic_info.add_item('longitude', f"{TELESCOPE_CONFIG['longitude']}°")
        self.basic_info.add_item('latitude', f"{TELESCOPE_CONFIG['latitude']}°")
        self.basic_info.add_item('altitude_text', f"{TELESCOPE_CONFIG['altitude']}m")
        left_layout.addWidget(self.basic_info.get_widget())
        
        # 设备控制组件列表
        self.device_controls = []
        
        # 设备连接状态组
        self.device_group = InfoGroup('device_connection')
        self.device_group.layout.setSpacing(LAYOUT_CONFIG['group_spacing'])
        for device_id, name in DEVICES:
            device_control = DeviceControl(device_id, i18n.get_text(device_id))
            self.device_controls.append(device_control)
            self.device_group.layout.addLayout(device_control.get_layout())
        left_layout.addWidget(self.device_group.get_widget())

        # 中间栏
        middle_layout = QVBoxLayout()
        middle_layout.setSpacing(LAYOUT_CONFIG['section_spacing'])

        # 消旋器角度组
        self.rotator_angle_group = InfoGroup('rotator_angle_group')
        self.rotator_angle_group.layout.setSpacing(LAYOUT_CONFIG['group_spacing'])
        
        # 添加角度可视化组件
        angle_layout = QHBoxLayout()
        
        # 左侧文本信息
        text_layout = QVBoxLayout()
        self.rotator_angle_group.add_item('frame_dec_angle', '45°', 'large-text')
        for pair in self.rotator_angle_group.pairs.values():
            text_layout.addLayout(pair.get_layout())
        angle_layout.addLayout(text_layout)
        
        # 右侧可视化组件
        self.angle_visualizer = AngleVisualizer()
        angle_layout.addWidget(self.angle_visualizer)
        
        self.rotator_angle_group.layout.addLayout(angle_layout)
        middle_layout.addWidget(self.rotator_angle_group.get_widget())

        # 望远镜状态组
        self.telescope_status = InfoGroup('telescope_status')
        self.telescope_status.layout.setSpacing(LAYOUT_CONFIG['group_spacing'])
        self.telescope_status.add_item('ra', '12:00:00', 'large-text')
        self.telescope_status.add_item('dec', '+30:00:00', 'large-text')
        self.telescope_status.add_item('alt', '60°', 'medium-text')
        self.telescope_status.add_item('az', '120°', 'medium-text')
        self.telescope_status.add_item('status', i18n.get_text('tracking'))
        middle_layout.addWidget(self.telescope_status.get_widget())
        
        # 新增高度方位驱动器状态组
        self.altaz_drive_status = InfoGroup('altaz_drive_status')
        self.altaz_drive_status.layout.setSpacing(LAYOUT_CONFIG['widget_spacing'])
        self.altaz_drive_status.add_item('drive_power', i18n.get_text('enabled'), 'medium-text')
        self.altaz_drive_status.add_item('drive_enabled', i18n.get_text('enabled'), 'medium-text')
        self.altaz_drive_status.add_item('motor_status', i18n.get_text('normal'), 'medium-text')
        middle_layout.addWidget(self.altaz_drive_status.get_widget())
        
        # 新增圆顶状态组
        self.dome_status = InfoGroup('dome_status')
        self.dome_status.layout.setSpacing(LAYOUT_CONFIG['widget_spacing'])
        self.dome_status.add_item('dome_angle', '180°', 'medium-text')
        self.dome_status.add_item('shutter_status', i18n.get_text('open'), 'medium-text')
        self.dome_status.add_item('dome_slewing', i18n.get_text('no'), 'medium-text')
        middle_layout.addWidget(self.dome_status.get_widget())
        
        # 新增主镜罩状态组
        self.mirror_cover_status = InfoGroup('mirror_cover_status')
        self.mirror_cover_status.layout.setSpacing(LAYOUT_CONFIG['widget_spacing'])
        self.mirror_cover_status.add_item('cover_status', i18n.get_text('closed'), 'medium-text')
        middle_layout.addWidget(self.mirror_cover_status.get_widget())

        # 调焦器状态组
        self.focuser_status = InfoGroup('focuser_status')
        self.focuser_status.layout.setSpacing(LAYOUT_CONFIG['widget_spacing'])
        self.focuser_status.add_item('position', '34000/60000', 'medium-text')
        self.focuser_status.add_item('angle', '90°', 'medium-text')
        self.focuser_status.add_item('moving', i18n.get_text('moving_yes'))
        self.focuser_status.add_item('temperature', '-10.0°C', 'medium-text')
        self.focuser_status.add_item('last_focus', '2025-02-23 12:00:00')
        middle_layout.addWidget(self.focuser_status.get_widget())

        # 右侧栏
        right_layout = QVBoxLayout()
        right_layout.setSpacing(LAYOUT_CONFIG['section_spacing'])

        # 全天相机组
        // ... existing code ...
        
        # 环境监测组
        // ... existing code ...

        # 时间显示组
        self.time_group = InfoGroup('current_time')
        self.time_group.layout.setSpacing(LAYOUT_CONFIG['widget_spacing'])
        self.time_group.add_item('utc8', '', 'medium-text')
        # 新增GPS时间
        self.time_group.add_item('gps_time', '', 'medium-text')
        self.time_group.add_item('sunrise_sunset', '', 'medium-text')
        self.time_group.add_item('twilight', '', 'medium-text')
        self.time_group.add_item('moon_phase', '', 'medium-text')
        self.time_group.add_item('sun_altitude', '', 'medium-text')
        right_layout.addWidget(self.time_group.get_widget())

        // ... existing code ...
    
    def update_time_info(self):
        """更新时间信息"""
        # 更新时间
        time_info = astronomy_service.get_current_time()
        self.time_group.pairs['utc8'].set_value(time_info['utc8'])
        
        # 更新GPS时间
        if 'gps_time' in time_info:
            self.time_group.pairs['gps_time'].set_value(time_info['gps_time'])
        
        // ... existing code ...
```

```python:src/utils/i18n.py
// ... existing code ...
    def __init__(self):
        self.current_language = 'cn'
        self.translations = {
            // ... existing code ...
            
            # 新增翻译项
            'gps_time': {'cn': 'GPS时间', 'en': 'GPS Time'},
            'dome_status': {'cn': '圆顶状态', 'en': 'Dome Status'},
            'dome_angle': {'cn': '圆顶方位角', 'en': 'Dome Azimuth'},
            'shutter_status': {'cn': '天窗状态', 'en': 'Shutter Status'},
            'dome_slewing': {'cn': '圆顶转动', 'en': 'Dome Slewing'},
            'mirror_cover_status': {'cn': '主镜罩状态', 'en': 'Mirror Cover Status'},
            'cover_status': {'cn': '镜罩状态', 'en': 'Cover Status'},
            'altaz_drive_status': {'cn': '高度方位驱动器状态', 'en': 'Alt-Az Drive Status'},
            'drive_power': {'cn': '驱动器电源', 'en': 'Drive Power'},
            'drive_enabled': {'cn': '驱动器使能', 'en': 'Drive Enabled'},
            'motor_status': {'cn': '电机状态', 'en': 'Motor Status'},
            'enabled': {'cn': '已启用', 'en': 'Enabled'},
            'disabled': {'cn': '已禁用', 'en': 'Disabled'},
            'normal': {'cn': '正常', 'en': 'Normal'},
            'error': {'cn': '错误', 'en': 'Error'},
            'open': {'cn': '已打开', 'en': 'Open'},
            'closed': {'cn': '已关闭', 'en': 'Closed'},
            'opening': {'cn': '正在打开', 'en': 'Opening'},
            'closing': {'cn': '正在关闭', 'en': 'Closing'},
            // ... existing code ...
        }
```

## 解释说明

按照您的需求，我已经对界面进行了以下修改：

1. **增加的功能**：
   - GPS时间显示（添加到时间组中）
   - 圆顶状态信息，包括角度和天窗开关
   - 高度方位驱动器状态，包括驱动器使能和电源状态
   - 主镜罩状态信息

2. **移除的功能**：
   - 相机状态组（整个InfoGroup已移除）
   - 滤光片状态信息已移除
   - 相机温度信息已移除

3. **新增的国际化翻译**：
   - 为所有新增组件添加了中英文翻译选项
   - 包括圆顶状态、天窗状态、主镜罩状态、高度方位驱动器等相关词条

这些修改保持了原有界面的布局结构和风格，同时满足了新的功能需求。系统仍然支持中英文切换，并且新增的组件也会随语言更新。

您可以按照这些更新来修改代码，如果需要进一步调整或有其他需求，请随时告知。

---



---

